<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/styles.css">
    <title>首頁 - LUM ZenMind</title>
    <style>
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: white;
            background-color: #7e57c2;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="user-greeting">
        <div id="user-avatar" class="user-avatar">U</div>
        <div class="greeting-text">
            <h3 id="user-name">你好，使用者</h3>
            <div id="date-display" class="date-display"></div>
        </div>
    </div>

    <div class="quick-stats">
                        <div class="stat-box">
                            <div class="stat-value">62%</div>
                            <div class="stat-label">今日目標完成</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">15分鐘</div>
                            <div class="stat-label">冥想時間</div>
                        </div>
                    </div>
                    
                    <h3 class="section-title">今日計劃</h3>
                    <div class="card">
                        <ul class="task-list">
                            <li class="task-item">
                                <div class="task-icon">✓</div>
                                <div class="task-info">
                                    <div class="task-name">晨間冥想</div>
                                    <div class="task-desc">完成度 100%</div>
                                </div>
                                <div class="task-time">06:30</div>
                            </li>
                            <li class="task-item">
                                <div class="task-icon">✓</div>
                                <div class="task-info">
                                    <div class="task-name">輕度健身</div>
                                    <div class="task-desc">完成度 100%</div>
                                </div>
                                <div class="task-time">07:00</div>
                            </li>
                            <li class="task-item">
                                <div class="task-icon">⏱️</div>
                                <div class="task-info">
                                    <div class="task-name">午餐時間</div>
                                    <div class="task-desc">即將開始</div>
                                </div>
                                <div class="task-time">12:30</div>
                            </li>
                        </ul>
                    </div>
                    
                    <h3 class="section-title">推薦好文</h3>
                    <div class="recommended-articles">
                        <div class="article-card">
                            <div class="article-image"></div>
                            <div class="article-content">
                                <div class="article-title">如何透過正念冥想減輕壓力</div>
                                <div class="article-meta">
                                    <span>健康生活</span>
                                    <span>5分鐘閱讀</span>
                                </div>
                            </div>
                        </div><!DOCTYPE html>


                        <div class="article-card">
                            <div class="article-image"></div>
                            <div class="article-content">
                                <div class="article-title">簡單瑜伽動作，改善辦公室久坐問題</div>
                                <div class="article-meta">
                                    <span>運動健身</span>
                                    <span>3分鐘閱讀</span>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- 引入底部導航 -->
    <div id="bottom-nav"></div>
    <script>
    // 引入底部導航
        fetch("/components/bottom-nav.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("bottom-nav").innerHTML = data;
            })
            .catch(err => console.error("無法載入導航欄", err));
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

        // Firebase 設定
        const firebaseConfig = {
            apiKey: "AIzaSyBMPBJOBzSrJZUHK781948I_ROqVux3YHI",
            authDomain: "lumzenmind.firebaseapp.com",
            projectId: "lumzenmind",
            storageBucket: "lumzenmind.appspot.com",
            messagingSenderId: "1028669516548",
            appId: "1:1028669516548:web:3888d2c7bd5d1747207e51",
            measurementId: "G-DMYR2Q35NG"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // 日期顯示
        const dateDisplay = document.getElementById("date-display");
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        dateDisplay.textContent = now.toLocaleDateString('zh-TW', options);

        // 監聽登入狀態
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // 取得使用者名稱和頭像
                document.getElementById("user-name").innerText = `你好，${user.displayName || user.email}`;
                
                const userAvatar = document.getElementById("user-avatar");

                if (user.photoURL) {
                    // 如果有頭像
                    userAvatar.innerHTML = `<img src="${user.photoURL}" alt="User Avatar">`;
                } else {
                    // 如果沒有頭像，顯示縮寫
                    const initial = (user.displayName || user.email).charAt(0).toUpperCase();
                    userAvatar.innerText = initial;
                }

                // 取得用戶資料
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    document.getElementById("goal-progress").innerText = `${userData.goalProgress || 0}%`;
                    document.getElementById("meditation-time").innerText = `${userData.meditationTime || 0} 分鐘`;
                }
            } else {
                window.location.href = "/login.html"; // 如果未登入則跳轉回登入頁
            }
        });
    </script>
</body>
</html>
